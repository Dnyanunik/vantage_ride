<div class="network-banner offline" *ngIf="isOffline">
  <mat-icon>wifi_off</mat-icon>
  <span>CONNECTION LOST: YOU ARE OFFLINE</span>
</div>

<div class="loading-progress-bar" *ngIf="loading || saving">
  <div class="glow-runner"></div>
</div>
<div class="cockpit-container" [class.dark-mode]="themeService.themeSignal() === 'dark'">
  <div class="profile-card glass-panel">

    <div class="card-header">
      <mat-icon class="header-icon">manage_accounts</mat-icon>
      <h2>Your Profile</h2>
      <p>Manage your identity and comms</p>
    </div>

    <div *ngIf="loading" class="loading-scanner">Scanning Database...</div>

    <div *ngIf="!loading" class="profile-content">

      <div class="identity-zone">
        <div class="avatar-wrapper">
          <img [src]="avatarUrl || 'assets/default-pilot.png'" alt="Avatar">
          <label class="upload-btn">
            <mat-icon>camera_enhance</mat-icon>
            <input type="file" hidden (change)="onFileSelected($event)" accept="image/*">
          </label>
        </div>

        <div class="status-badges">
          <span class="badge role-badge">{{ userRole | uppercase }}</span>
          <span class="badge verified-badge" [class.active]="isVerified">
            <mat-icon>{{ isVerified ? 'verified' : 'gpp_maybe' }}</mat-icon>
            {{ isVerified ? 'VERIFIED' : 'UNVERIFIED' }}
          </span>
        </div>
      </div>

      <form [formGroup]="profileForm" (ngSubmit)="updateProfile()" class="cyber-form">

        <div class="form-group">
          <label>Call Sign (Username)</label>
          <div class="input-wrapper">
            <mat-icon>alternate_email</mat-icon>
            <input type="text" formControlName="username" placeholder="e.g. Maverick">
          </div>
          <small class="error" *ngIf="profileForm.get('username')?.errors?.['minlength']">
            Must be at least 3 characters.
          </small>
        </div>

        <div class="form-group">
          <label>Full Legal Name</label>
          <div class="input-wrapper">
            <mat-icon>badge</mat-icon>
            <input type="text" formControlName="full_name" placeholder="Enter full name">
          </div>
        </div>

        <div class="form-group">
          <label>Comms Link (Phone)</label>
          <div class="input-wrapper">
            <mat-icon>phone</mat-icon>
            <input type="tel" formControlName="phone_number" placeholder="+91 00000 00000">
          </div>
        </div>

        <button type="submit" class="save-btn" [disabled]="profileForm.invalid || saving">
          <span *ngIf="!saving">UPDATE SYSTEM</span>
          <span *ngIf="saving">SYNCHRONIZING...</span>
        </button>

      </form>
    </div>
  </div>
  <div class="avatar-container">
  <img [src]="avatarUrl || 'assets/default-pilot.png'" class="avatar-preview">

  <div class="upload-overlay">
    <label for="avatar-input" class="upload-label">
      {{ loading ? 'UPLOADING...' : 'CHANGE PHOTO' }}
    </label>
    <input
      id="avatar-input"
      type="file"
      accept="image/*"
      (change)="onFileSelected($event)"
      [disabled]="loading"
      hidden
    >
  </div>
</div>
</div>
